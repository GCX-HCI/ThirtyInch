sudo: required

language: android
jdk: oraclejdk8

services:
  - docker
  
env:
 - TEST_SUITE=unit
 - TEST_SUITE=instrumentation
  
android:
  components:
    - $(if [ $TEST_SUITE == "instrumentation" ]; then ./.travisAndroidComponents.sh; fi)

before_install:
  - if [ $TEST_SUITE == "unit" ]; then
    docker pull stefma-docker-hub.bintray.io/android-build-env:0.1-alpha;
    fi
    
before_script:
  # Emulator Management: Create, Start and Wait
  - if [ $TEST_SUITE == "instrumentation" ]; then
    ./gradlew assemble;
    echo no | android create avd --force -n test -t android-22 --abi armeabi-v7a;
    emulator -avd test -no-skin -no-audio -no-window &
    android-wait-for-emulator;
    adb shell input keyevent 82 &
    fi   

script:
  - if [ $TEST_SUITE == "instrumentation" ]; then 
    ./gradlew assembleAndroidTest connectedCheck;
    fi
  - if [ $TEST_SUITE == "unit" ]; then
    docker run -i -v $PWD:/project -t stefma-docker-hub.bintray.io/android-build-env:0.1-alpha /bin/bash -c "./gradlew build jacocoTestReport";
    fi

after_success:
  - bash <(curl -s https://codecov.io/bash)